spring:

  server:
  port: ${SERVER_PORT:0} # 환경변수 없으면 0으로 랜덤

  redis:
    host: localhost
    port: 6379
  
  
# Email Configuration
  mail:
    host: ${MAIL_HOST:smtp.gmail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
          ssl:
            trust: smtp.gmail.com


  datasource:
    # 환경변수 DATASOURCE_URL이 없으면 기본 URL 사용
    url:       jdbc:mysql://${RDS_ENDPOINT}:3306/${RDS_DB_NAME}?useSSL=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8
    # 환경변수 DATASOURCE_USERNAME/PASSWORD이 없으면 root/1234 사용
    username:  ${DATASOURCE_USERNAME}
    password:  ${DATASOURCE_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver

    hikari:
      maximum-pool-size: 3       # 최대 연결 수를 3으로 줄임
      minimum-idle: 1            # 최소 유휴 연결 수
      idle-timeout: 30000        # 30초 후 유휴 연결 해제
      max-lifetime: 300000       # 5분 후 연결 재생성
      connection-timeout: 10000  # 10초 연결 타임아웃
      leak-detection-threshold: 5000  # 5초 후 연결 누수 감지
      validation-timeout: 3000   # 검증 타임아웃 3초

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
    database-platform: org.hibernate.dialect.MySQL8Dialect
  hikari:
    maximum-pool-size: 10       # 서비스당 최대 10개
    minimum-idle: 2
    idle-timeout: 30000         # 30초
    max-lifetime: 600000        # 10분
    connection-timeout: 30000
  doc:
    api-docs:
      path: /api-docs
    swagger-ui:
      path: /docs
      operationsSorter: alpha
      show-common-extensions: true

  security:
    oauth2:
      client:
        registration:
          google:
            client-id:     ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope:
              - openid
              - profile
              - email
            # 리디렉션 URI (registrationId 자리에는 'google'이 들어감)
            redirect-uri:  http://localhost:8080/oauth2/redirection/{registrationId}

          kakao:
            client-id:     ${KAKAO_CLIENT_ID}
            client-secret: ${KAKAO_CLIENT_SECRET}
            scope:
              - profile_nickname
              - profile_image
            redirect-uri:  http://localhost:8080/oauth2/redirection/{registrationId}
            authorization-grant-type: authorization_code
            client-authentication-method: client_secret_post  # 이 줄도 명시 추천

        provider:
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri:         https://kauth.kakao.com/oauth/token
            user-info-uri:     https://kapi.kakao.com/v2/user/me
            user-name-attribute: id

jwt:
  secret: ${JWT_SECRET}
  expiration-ms: ${JWT_EXPIRATION_MS}
  access-expiry-ms: 900000       # 15분
  refresh-expiry-ms: 1209600000  # 14일

services:
  user:
    url: http://localhost:8081

logging:
  level:
    org.springframework.security: TRACE


grpc:
  server:
    security:
      enabled: false

cloud:
  aws:
    credentials:
      access-key: ${AWS_ACCESS_KEY}
      secret-key: ${AWS_SECRET_KEY}
    region:
      static: ${S3_REGION}
    s3:
      bucket: ${S3_BUCKET}

# Email Verification Configuration
app:
  email:
    verification:
      subject: 상삼점(상점) 이메일 인증 코드
      code-length: 6
      expiration-minutes: 10
      max-attempts: 5

